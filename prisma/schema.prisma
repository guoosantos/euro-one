generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = env("DATABASE_PROVIDER") ?? "postgresql"
  url      = env("DATABASE_URL")
}

model StorageCollection {
  key       String   @id
  data      Json
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model CrmClient {
  id                    String   @id @default(uuid())
  clientId              String
  cnpj                  String?
  name                  String
  segment               String?
  companySize           String?
  city                  String?
  state                 String?
  website               String?
  mainContactName       String?
  mainContactRole       String?
  mainContactPhone      String?
  mainContactEmail      String?
  interestLevel         String?
  closeProbability      String?
  tags                  Json?
  hasCompetitorContract Boolean  @default(false)
  competitorName        String?
  competitorContractStart DateTime?
  competitorContractEnd DateTime?
  inTrial               Boolean  @default(false)
  trialProduct          String?
  trialStart            DateTime?
  trialDurationDays     Int?
  trialEnd              DateTime?
  notes                 String?
  relationshipType      String?
  createdByUserId       String?
  reservedDeviceIds     Json?
  contractStart         DateTime?
  contractDurationDays  Int?
  contractEnd           DateTime?
  convertedClientId     String?
  traccarGroupId        String?
  traccarGroupName      String?
  traccarUserId         String?
  conversionError       String?
  dealId                String?
  contacts              Json?
  soldDeviceIds         Json?
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
}

model CrmTag {
  id        String   @id @default(uuid())
  clientId  String
  name      String
  color     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model PipelineStage {
  id          String   @id @default(uuid())
  clientId    String?
  name        String
  order       Int
  probability Int?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  deals Deal[]
}

model Deal {
  id          String   @id @default(uuid())
  clientId    String?
  crmClientId String?
  title       String
  value       Float    @default(0)
  probability Int?
  stageId     String
  status      String   @default("open")
  ownerUserId String?
  expectedCloseDate DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  wonAt       DateTime?
  lostAt      DateTime?
  soldDeviceIds Json?

  stage PipelineStage @relation(fields: [stageId], references: [id])
}

model Activity {
  id            String   @id @default(uuid())
  clientId      String?
  crmClientId   String?
  dealId        String?
  type          String
  date          DateTime?
  result        String?
  notes         String?
  createdByUserId String?
  createdAt     DateTime @default(now())
}

model Reminder {
  id            String   @id @default(uuid())
  clientId      String?
  crmClientId   String?
  dealId        String?
  description   String
  remindAt      DateTime?
  category      String?
  status        String   @default("pending")
  createdByUserId String?
  createdAt     DateTime @default(now())
}

model Task {
  id                String   @id @default(uuid())
  clientId          String
  vehicleId         String?
  driverId          String?
  address           String?
  geoFenceId        String?
  geofenceRadius    Int?
  latitude          Float?
  longitude         Float?
  startTimeExpected DateTime?
  endTimeExpected   DateTime?
  arrivalTime       DateTime?
  serviceStartTime  DateTime?
  serviceEndTime    DateTime?
  checklistCompleted Boolean  @default(false)
  type              String
  status            String
  attachments       Json?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

model TaskTemplate {
  id          String   @id @default(uuid())
  clientId    String
  name        String
  description String?
  payload     Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
